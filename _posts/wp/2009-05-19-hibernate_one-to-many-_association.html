---
layout: post
title: Hibernate one-to-many  association
categories:
- Hibernate
tags:
- Hibernate
published: true
comments: true
---
<p>one-to-many单向关联：<br />
Company类:维护关系
<pre lang="java5">
public class Company implements Serializable{
private Integer cid;
private String cname;</pre></p>

<p>private String address;<br />
private Set<employee> employees=new HashSet</employee><employee>();<br />
//..............<br />
public void hire(Employee emp){<br />
this.employees.add(emp);<br />
emp.setCompany(this);<br />
}
public void fire(Employee e){<br />
e.setCompany(null);<br />
this.employees.remove(e);<br />
}
}
</employee></p>

<p><!--more-->
Employee:没有维护关系，只需要管好自己
<pre lang="java5">
public class Employee {
private Integer eid;
private String ename;
private Date birthday;
private int age;
private Company company;
}
</pre></p>

<p>sql语句:
<pre lang="sql">
create sequence jdbc_company_seq;
create sequence jdbc_employee_seq;
create table jdbc_company
( cid number(7) primary key,
cname varchar2(15) not null unique,
address varchar2(15)
);
create table jdbc_employee
( eid number(7) primary key,
ename varchar2(15) not null,
birthday date ,
age number(3),
company_id number(7) references jdbc_company(cid)
);
</pre>
映射文件：
<pre lang="xml">
<class name="Company" table="jdbc_company">
<id name="cid" column="cid" unsaved-value="null">
<generator class="sequence">
<param name="sequence" />jdbc_company_seq
</generator>
</id>
<property name="cname"></property>
<property name="address"></property>
<set name="employees" table="jdbc_employee" cascade="save-update"> //由Company类维护关系属性
<key column="company_id"></key> //key这个元素在父映射元素定义了对新表的连接，并且在被连接表中定义了一个外键引用原表的主键的情况下经常使用。
<one -to-many class="Employee" /> //one-to-many 指明一个company与许多employee对应 =======================java类中的关系
</set>
</class>
<class name="Employee" table="jdbc_employee">
<id name="eid" column="eid" unsaved-value="null">
<generator class="sequence">
<param name="sequence" />jdbc_employee_seq
</generator>
</id>
<property name="ename"></property>
<property name="birthday"></property>
<property name="age"></property>
</class>
</pre></p>

<p>***************************************************<br />
cascade="save-update"用来级联操作</p>

<p>one-to-many双向关联：<br />
要建立一个一对多的双向关联，你可以通过把一个一对多关联，作为一个多对一关联映射到到同一张表的字段上，并且在"多"的那一端定义inverse="true"。<br />
eg：
<pre lang="xml">
<class name="Company" table="jdbc_company">
<id name="cid" column="cid" unsaved-value="null">
<generator class="sequence">
<param name="sequence" />jdbc_company_seq
</generator>
</id>
<property name="cname"></property>
<property name="address"></property>
<set name="employees" table="jdbc_employee" inverse="true" cascade="save-update">
<key column="company_id"></key>
<one -to-many class="Employee" />
</set>
</class>
<class name="Employee" table="jdbc_employee">
<id name="eid" column="eid" unsaved-value="null">
<generator class="sequence">
<param name="sequence" />jdbc_employee_seq
</generator>
</id>
<property name="ename"></property>
<property name="birthday"></property>
<property name="age"></property>
<many -to-one name="company"
class="Company" column="company_id" not-null="true"/>
</class>
</pre>
在“一”这一端定义inverse="true"不会影响级联操作，二者是正交的概念！</p>

<p>many-to-one双向关联：
<pre lang="xml">
<class name="Person">
<id name="id" column="personId">
<generator class="native" />
</id>
<many -to-one name="address"
column="addressId"
not-null="true"/>
</class></pre></p>

<p><class name="Address">
<id name="id" column="addressId">
<generator class="native" />
</id>
<set name="people" inverse="true">
<key column="addressId" />
<one -to-many class="Person" />
</set>
</class>

create table Person ( personId bigint not null primary key, addressId bigint not null )<br />
create table Address ( addressId bigint not null primary key )</p>

<p>many-to-one单向关联：
<pre lang="xml">
<class name="Person">
<id name="id" column="personId">
<generator class="native" />
</id>
<many -to-one name="address"
column="addressId"
not-null="true"/>
</class></pre></p>

<p><class name="Address">
<id name="id" column="addressId">
<generator class="native" />
</id>
</class></p>

<p>create table Person ( personId bigint not null primary key, addressId bigint not null )<br />
create table Address ( addressId bigint not null primary key )</p>
