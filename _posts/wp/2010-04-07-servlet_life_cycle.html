---
layout: post
title: Servlet生命周期
categories:
- JSP
tags:
- JSP
- lifecycle
- Servlet
published: true
comments: true
---
<p>Servlet生命周期是面试中经常问道的问题。Servlet运行在Servlet容器中，其生命周期由容器来管理。Servlet的生命周期通过javax.servlet.Servlet接口中的init()、service()和destroy()方法来表示。<br />
关于Servlet生命周期，<span style="color: #ff0000;">首先要明白在Servlet生命周期中，servlet对象只存在一个</span>，明白这一点是很重要的。由于servlet对象只存在一个，<span style="color: #ff0000;">所以servlet对象只new一次，初始化一次</span>。<!--more--></p>

<p>Servlet的生命周期包含了下面4个阶段：</p>

<p>（1）加载和实例化<br />
Servlet容器负责加载和实例化Servlet。当Servlet容器启动时，或者在容器检测到需要这个Servlet来响应第一个请求时，Servlet容器可以从本地文件系统、远程文件系统或者其他的网络服务中通过类加载器加载Servlet类，成功加载后，容器创建Servlet的实例。因为容器是通过Java的反射API来创建 Servlet实例，调用的是Servlet的默认构造方法（即不带参数的构造方法），所以我们在编写Servlet类的时候，如果提供带参数的构造方法，还必须提供不带参数的构造方法。</p>

<p>（2）初始化<br />
在Servlet实例化之后，<span style="color: #ff0000;"><span style="text-decoration: underline;">当客户端第一次访问服务器端调用相应的请求时</span></span>，容器将调用Servlet的init()方法初始化这个对象。初始化的目的是为了让Servlet对象在处理客户端请求前完成一些初始化的工作，如建立数据库的连接，获取配置信息等。<span style="color: #ff0000;">对于每一个Servlet实例，init()方法只被调用一次。</span>在初始化期间，Servlet实例可以使用容器为它准备的ServletConfig对象从Web应用程序的配置信息（在web.xml中配置）中获取初始化的参数信息。在初始化期间，如果发生错误，Servlet实例可以抛出ServletException异常或者UnavailableException异常来通知容器。ServletException异常用于指明一般的初始化失败，例如没有找到初始化参数；而UnavailableException异常用于通知容器该Servlet实例不可用。例如，数据库服务器没有启动，数据库连接无法建立，Servlet就可以抛出 UnavailableException异常向容器指出它暂时或永久不可用。</p>

<p>（3）请求处理<br />
Servlet容器调用Servlet的service()方法对请求进行处理。<span style="color: #ff0000;">在处理的过程中，servlet以多线程的方式并反执行，每个线程调用的是Servlet对象的一个应用。</span>要注意的是，<span style="color: #ff0000;"><span style="text-decoration: underline;">在service()方法调用之前，init()方法必须成功执行</span></span>。注意，<span style="color: #0000ff;">在servlet对象当中（一般是由开发者继承的一个javax.servlet.HttpServlet类），先调用javax.servlet.Servlet接口中的抽象的service()方法，然后调用javax.servlet.HttpServlet中的受保护的service()方法，最后在该受保护的service()方法中，Servlet实例通过ServletRequest对象得到客户端的相关信息和请求信息，调用相应的doXXX()方法</span>。在对请求进行处理后，调用ServletResponse对象的方法设置响应信息。在service()方法执行期间，如果发生错误，Servlet实例可以抛出 ServletException异常或者UnavailableException异常。如果UnavailableException异常指示了该实例永久不可用，Servlet容器将调用实例的destroy()方法，释放该实例。此后对该实例的任何请求，都将收到容器发送的HTTP 404（请求的资源不可用）响应。如果UnavailableException异常指示了该实例暂时不可用，那么在暂时不可用的时间段内，对该实例的任何请求，都将收到容器发送的HTTP 503（服务器暂时忙，不能处理请求）响应。</p>

<p>（4）服务终止<br />
当容器检测到一个Servlet实例应该从服务中被移除的时候，容器就会调用实例的destroy()方法，以便让该实例可以释放它所使用的资源，保存数据到持久存储设备中。当需要释放内存或者容器关闭时，容器就会调用Servlet实例的destroy()方法。在destroy()方法调用之后，容器会释放这个Servlet实例，该实例随后会被Java的垃圾收集器所回收。如果再次需要这个Servlet处理请求，Servlet容器会创建一个新的Servlet实例。</p>

<p><span style="color: #ff0000;">在整个Servlet的生命周期过程中，创建Servlet实例、调用实例的init()和destroy()方法都只进行一次</span>，当初始化完成后，Servlet容器会将该实例保存在内存中，通过调用它的service()方法，为接收到的请求服务。</p>

<p>如果需要让Servlet容器在启动时即加载Servlet，可以在web.xml文件中配置&lt;load-on-startup&gt;元素</p>
