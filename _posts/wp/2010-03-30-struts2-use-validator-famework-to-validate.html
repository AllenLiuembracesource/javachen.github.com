---
layout: post
title: Struts2使用validator框架进行数据校验
categories:
- Struts
tags:
- Struts
- Struts2
published: true
comments: true
---
<p>在<a href="http://www.javachen.com/2010/03/struts2-action-validate-method/">《Struts2使用validate方法验证数据》</a>一文中学到了如何用validate方法对数据进行校验，这种方法虽然不错，但需要大量重写的validate方法。由于Struts 2的校验框架实际上是基于XWork的validator框架，所以我们可以用XWork的validator框架对struts2的进行数据校验，减少代码的开发。<br />
     使用XWork的validator框架进行数据校验，首先要写一个配置文件，该文件的命名应该遵守如下规则：<br />
ActionName-validation.xml：其中ActionName就是需要校验的Action的类名，且该文件应该与Action类的class文件位于同一个路径下。增加该检验规则文件后，Action不必重写validate()方法也可完成输入校验。<!--more-->
    如何编写ActionName-validation.xml这个校验文件呢？该文件首先需要定义一个文件头：
<pre lang="xml" line="1">
< !DOCTYPE validators PUBLIC "-//OpenSymphony Group//XWork Validator 1.0.2//EN" 
 "http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd">
</pre>
如果对XML比较熟悉的话，就会知道该配置文件的根节点为：validators，节点的设置需要遵循"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"这个dtd文件，我们可以打开这网址，查看该dtd文件对节点的设置是如何约束的。
<pre lang="xml" line="1">
< ?xml version="1.0" encoding="UTF-8"?>
<!--<br>
  XWork Validators DTD.<br>
  Used the following DOCTYPE.<br>
  <br>
  <!DOCTYPE validators PUBLIC <br>
  		"-//OpenSymphony Group//XWork Validator 1.0.2//EN" <br>
  		"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd">
--></pre></p>

<p>< !ELEMENT validators (field|validator)+>
< !ELEMENT field (field-validator+)>
< !ATTLIST field<br />
	name CDATA #REQUIRED<br />
>
< !ELEMENT field-validator (param*, message)>
< !ATTLIST field-validator<br />
	type CDATA #REQUIRED<br />
    short-circuit (true|false) "false"<br />
></p>

<p>< !ELEMENT validator (param*, message)>
< !ATTLIST validator<br />
	type CDATA #REQUIRED<br />
    short-circuit (true|false) "false"<br />
></p>

<p>< !ELEMENT param (#PCDATA)>
< !ATTLIST param<br />
    name CDATA #REQUIRED<br />
></p>

<p>< !ELEMENT message (#PCDATA)>
< !ATTLIST message<br />
    key CDATA #IMPLIED<br />
>
</p>

<p>从该dtd文件可以看出validators 根节点下必须有一个或多个field或是validator，也可以两者都有。由此，可以看出该验证有两种方式：字段校验和非字段校验。field节点必须有name属性，可以有一个或多个field-validator子节点。field-validator节点中必须有0个或多个param子节点，最后要有一个message子节点，field-validator还必须有一个type属性，默认有一个值为false的short-circuit属性。</p>

<p>在XWork的jar包里，有一个default.xml的文件，他定义了field-validator的属性type可以取哪些值，并且每一个值对应一个类，在对应的类中可以找到param子节点可以定义哪些值。大家可以打开default.xml看看，这里就不用贴出来了。</p>

<p>知道了dtd文件是如何定义的，就可以很快的写出一个配置文件出来了，下面是一个例子：
<pre lang="xml" line="1">
< !DOCTYPE validators PUBLIC "-//OpenSymphony Group//XWork Validator 1.0.2//EN"    
  "http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd">
<validators>
    <field name="password">
        </field><field -validator type="requiredstring">
            <message key="error.password.required" />
        </field>
        <field -validator type="stringlength">
            <param name="trim" />true
            <param name="minLength" />4
            <param name="maxLength" />10
            <message key="errors.range" />
        </field>
    
</validators>
</pre>
上面<message>提示信息也可以国际化,</message><message key="””">就可以显示资源文件里的key对应的value了。<br />
当一个Action中有多个业务方法时,每个业务方法都会使用这种验证,显然是不好的.例如Action中有方法public String regist(),我们可以为regist()专门定义一个配置文件,文件名称为RegistAction-methodName- validation.xml(Action名称-方法名- validation.xml)
</message></p>
