---
layout: post
title: JavaScript判断浏览器类型及版本
categories:
- JavaScript
tags:
- JavaScript
- navigator
published: true
comments: true
---
<p><blockquote>JavaScript是前端开发的主要语言，我们可以通过编写JavaScript程序来判断浏览器的类型及版本。JavaScript判断浏览器类型一般有两种办法，一种是根据各种浏览器独有的属性来分辨，另一种是通过分析浏览器的userAgent属性来判断的。在许多情况下，值判断出浏览器类型之后，还需判断浏览器版本才能处理兼容性问题，而判断浏览器的版本一般只能通过分析浏览器的userAgent才能知道。</blockquote>
<strong><span style="color: #00ff00;">navigator对象</span></strong>
包含了正在使用的 Navigator 的版本信息。 JavaScript 客户端运行时刻引擎自动创建 navigator 对象。 详细的介绍可以参照【http://www.itlearner.com/code/js_ref/brow1.htm】，这里只是简单说下其属性和方法。<!--more--></p>

<p><strong>属性概览</strong>
appCodeName 	指定浏览器的代码名称。<br />
appName 	指定浏览器的名称。<br />
appVersion 	指定 Navigator 的版本信息。<br />
language 	标明正在使用的 Navigator 的翻译语种。<br />
mimeTypes 	客户端支持的所有 MIME 类型数组。<br />
platform 	标明了 Navigator 编译适合的机器类型。<br />
plugins 	客户端已安装的所有插件数组。<br />
userAgent 	指定了用户代理头。</p>

<p><strong>方法概览</strong>
javaEnabled 	测试是否允许 Java。<br />
plugins.refresh 	使新安装的插件有效，并可选重新装入已打开的包含插件的文档。<br />
preference 	允许一个已标识的脚本获取并设置特定的 Navigator 参数。<br />
taintEnabled 	指定是否允许数据污点。</p>

<p>简单标注一下，判断浏览器的名称可以根据appName判断，例如：
<blockquote>var ie=navigator.appName == "Microsoft Internet Explorer" ? true : false;</blockquote>
<span style="color: #00ff00;"><strong>浏览器的特征及其userAgent</strong></span></p>

<p>关于各种浏览器的特征及其userAgent，可以参照【http://www.cnblogs.com/leadzen/archive/2008/09/06/1285764.html】，这篇文章介绍的比较详细。</p>

<p>简单罗列如下：
<strong>IE</strong>
只有IE支持创建ActiveX控件，因此她有一个其他浏览器没有的东西，就是ActiveXObject函数。<br />
而IE各个版本典型的userAgent如下：<br />
Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0)<br />
Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2)<br />
Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)<br />
Mozilla/4.0 (compatible; MSIE 5.0; Windows NT)<br />
其中，版本号是MSIE之后的数字。</p>

<p><strong>Firefox</strong>
Firefox中的DOM元素都有一个getBoxObjectFor函数，用来获取该DOM元素的位置和大小（IE对应的中是getBoundingClientRect函数）。<br />
这是Firefox独有的，判断它即可知道是当前浏览器是Firefox。<br />
Firefox几个版本的userAgent大致如下：<br />
Mozilla/5.0 (Windows; U; Windows NT 5.2) Gecko/2008070208 Firefox/3.0.1<br />
Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070309 Firefox/2.0.0.3<br />
Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070803 Firefox/1.5.0.12  其中，版本号是Firefox之后的数字。</p>

<p><strong>Opera</strong>
Opera提供了专门的浏览器标志，就是window.opera属性。<br />
Opera典型的userAgent如下：<br />
Opera/9.27 (Windows NT 5.2; U; zh-cn)<br />
Opera/8.0 (Macintosh; PPC Mac OS X; U; en)<br />
Mozilla/5.0 (Macintosh; PPC Mac OS X; U; en) Opera 8.0<br />
其中，版本号是靠近Opera的数字。</p>

<p><strong>Safari</strong>
Safari浏览器中有一个其他浏览器没有的openDatabase函数，可做为判断Safari的标志。<br />
Safari典型的userAgent如下：<br />
Mozilla/5.0 (Windows; U; Windows NT 5.2) AppleWebKit/525.13 (KHTML, like Gecko) Version/3.1 Safari/525.13<br />
Mozilla/5.0 (iPhone; U; CPU like Mac OS X) AppleWebKit/420.1 (KHTML, like Gecko) Version/3.0 Mobile/4A93 Safari/419.3<br />
其版本号是Version之后的数字。</p>

<p><strong>Chrome</strong>
Chrome有一个MessageEvent函数，但Firefox也有。不过，好在Chrome并没有Firefox的getBoxObjectFor函数，根据这个条件还是可以准确判断出Chrome浏览器的。<br />
目前，Chrome的userAgent是：<br />
Mozilla/5.0 (Windows; U; Windows NT 5.2) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/0.2.149.27 Safari/525.13<br />
其中，版本号在Chrome之后的数字。<br />
有趣的是，Chrome的userAgent还包含了Safari的特征，也许这就是Chrome可以运行所有Apple浏览器应用的基础吧。</p>

<p><strong>Navigator</strong>
目前，Navigator的userAgent是：<br />
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12) Gecko/20080219 Firefox/2.0.0.12 Navigator/9.0.0.6<br />
其中，版本号在Navigator之后的数字。<br />
通过观察以上各浏览器的差异，可以用JavaScript区分出各浏览器的，但没有判断是否兼容w3c标准，看了看ExtJs的源代码，发现其中就有对浏览器类型以及版本和操作系统的判断。<br />
源码如下：
<blockquote>
ua = navigator.userAgent.toLowerCase(),<br />
check = function(r){<br />
return r.test(ua);<br />
},<br />
isStrict = document.compatMode == "CSS1Compat",<br />
isOpera = check(/opera/),<br />
isChrome = check(/chrome/),<br />
isWebKit = check(/webkit/),<br />
isSafari = !isChrome &amp;&amp; check(/safari/),<br />
isSafari3 = isSafari &amp;&amp; check(/version\/3/),<br />
isSafari4 = isSafari &amp;&amp; check(/version\/4/),<br />
isIE = !isOpera &amp;&amp; check(/msie/),<br />
isIE7 = isIE &amp;&amp; check(/msie 7/),<br />
isIE8 = isIE &amp;&amp; check(/msie 8/),<br />
isGecko = !isWebKit &amp;&amp; check(/gecko/),<br />
isGecko3 = isGecko &amp;&amp; check(/rv:1\.9/),<br />
isBorderBox = isIE &amp;&amp; !isStrict,<br />
isWindows = check(/windows|win32/),<br />
isMac = check(/macintosh|mac os x/),<br />
isAir = check(/adobeair/),<br />
isLinux = check(/linux/)</blockquote>
<span style="color: #00ff00;"><strong>关于document.compatMode</strong></span>
IE对盒模型的渲染在 Standards Mode和Quirks Mode是有很大差别的，在Standards Mode下对于盒模型的解释和其他的标准浏览器是一样，但在Quirks Mode模式下则有很大差别，而在不声明Doctype的情况下，IE默认又是Quirks Mode。所以为兼容性考虑，我们可能需要获取当前的文档渲染方式。<br />
document.compatMode正好派上用场，它有两种可能的返回值：BackCompat和CSS1Compat，对其解释如下：<br />
BackCompat Standards-compliant mode is not switched on. (Quirks Mode)<br />
CSS1Compat Standards-compliant mode is switched on. (Standards Mode)<br />
在实际的项目中，我们还需要在获取浏览是否IE，这样就可以得到IE的渲染模式了。在ExtJs中的代码：isBorderBox=isIE&amp;&amp;!isStrict。<br />
当文档有了标准声明时， document.compatMode 的值就等于 "CSS1compat"， 因此， 我们可以根据 document.compatMode 的值来判断文档是否加了标准声明<br />
var height = document.compatMode=="CSS1Compat" ? document.documentElement.clientHeight : document.body.clientHeight;</p>
