---
layout: post
title: Servlets中的持久状态
categories:
- JSP
tags:
- JSP
- Servlet
published: true
comments: true
---
<p><strong>Servlets中的持久状态</strong>
<strong>1. HTTP协议中无状态的优缺点：</strong>
优点：可以服务很多客户端;<br />
缺点：不能在多个请求之间共享信息(通过Cookie和Session解决);</p>

<p><strong>2. Cookies</strong>
1) Cookies是Web服务器发送到浏览器的简短文本信息，以后在访问同一个Web站点或域时浏览器就会毫无更改地返回该文本信息。<br />
2) 用户可以决定是否接受Cookie。<br />
3) 一个Cookie由以下内容组成：<br />
a. name;<br />
b. value;<br />
c. 一些操作属性：路径或所在域、有效期以及版本号。</p>

<p>4) 每个站点，浏览器通常只接受20条Cookie,总共接受300条，以及每条Cookie限制为4KB。<!--more--><strong>3.  设置Cookie</strong>
1) 创建Cookie:<br />
Cookie c = new Cookie("CookieName", "CookieValue");<br />
2) 设置有效期：<br />
c.setMaxAge(int lifetime); 黙认为负值，只作用于当前会话，不能存储在磁盘上;如为0值表示删除Cookie；有效值为秒为单位。<br />
maxAge (s):<br />
24 * 60 * 60 * 7<br />
-1 : 生命周期由保存它的浏览器决定 .<br />
0 :<br />
3) 存到客户端:<br />
response.addCookie(c);<br />
4) 获取客户端存储的cookie :<br />
request.getCookies() ---&gt; Cookie[]</p>

<p>eg:<br />
Cookie[] cookies = request.getCookies();<br />
Cookie cookie;<br />
for(int i=0; i&lt;cookies.length; i++)<br />
{
cookie = cookies[i];<br />
out.println("&lt;tr&gt;&lt;td&gt;" + cookie.getName() + "&lt;/td&gt;&lt;td&gt;" + cookie.getValue());<br />
}</p>

<p><strong>4. Sessions</strong>
1) 一个客户端和一个服务器端一次连接信息的所有集合，通过brower发出，由服务器端的servlet调用;<br />
2) 提供一种方式在多个页面请求间确认用户或者储存关于用户的信息;<br />
3) 实现会话跟踪的三种方式：a. cookie; b. URL重写; c. 隐藏的表单段
<strong>
5. 设置Sessions</strong>
1) 创建Sessions:<br />
HttpSession session = request.getSession(true);<br />
true:原来有，用原来的；原来没有，创建新的<br />
false:原来有，用原来的；原来没有，返回null<br />
2) 用指定名称将一个对象绑定到session:<br />
public void setAttribute(String name, Object value);<br />
3) 删除与指定名称相关的所有值：<br />
public void removeAttribute(String name);<br />
4) 返回会话中所有属性名<br />
public Enumeration getAttributeNames();<br />
5) 返回指定名称对象
<strong> </strong> public Object getAttribute(String name);<strong></strong></p>

<p><strong>6. 比较Session和request :</strong>
1) 生命周期 .<br />
request :<br />
创建 : 当用户请求到达服务器的时候<br />
销毁 : 当本次请求的应答回到客户端的时候.<br />
session :<br />
创建 : 当用户第一次调用getSession( true )<br />
销毁 : 超时 ( 两级超时限制 )<br />
1) 内存 ---&gt; 文件 .<br />
2) 从文件系统销毁 .</p>

<p>2) 共享范围 :<br />
request : 用forward连接起来的多个servlet<br />
A ---&gt; B ----&gt; C ---&gt; D ;<br />
session : 在同一个浏览器的多次请求,应答之间被共享 (和浏览器绑定)</p>

<p>3) 适合存放什么样的数据 .<br />
request : 适合存放不会频繁重复使用的数据.<br />
体积较大的数据.<br />
session : 用户的个人数据<br />
在多次请求中重复使用的数据 .<br />
*  体积较大的数据要谨慎使用 .<br />
总结：<br />
1) Cookies可由用户决定是否需要, Sessions不能;<br />
2) Cookies是一种装载sessionID的可能;<br />
3) Cookies存储在客户端, Sessions存储于服务器端;<br />
4) Cookies可以构造，可以由Request取出，由Response返回</p>

<p><strong>7. URL 重写 </strong>
http://adbc;jsessionid=xxxxxxxxx</p>

<p>&lt;a href="xxxxxx"&gt;aaaa&lt;/a&gt;<br />
http://localhost:8989/servletapp/forwardB;jsessionid=37D50D093CCD4A37CC1118785E38F438<br />
http://localhost:8989/servletapp/forwardB</p>

<p>"url;jessionid="+ session.getId() + "&gt;"</p>

<p>response.encodeURL( "url" )<br />
===&gt; url;jessionid=xxxxxx;<br />
http://localhost:8989/servletapp/delete?id=6</p>
