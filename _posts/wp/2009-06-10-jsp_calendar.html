---
layout: post
title: JSP自定义日历标签
categories:
- JSP
tags:
- JSP
published: true
comments: true
---
<p><p><strong>1.配置文件：</strong><br />
将jstl.jar和standard.jar两jar包配置到WEB－INF下的lib目录或是根目录下的lib目录下。<br />
<strong>2.配置tld文件</strong><br />
<font color="red">calendar.tld －－－>文件名任意</font></p>
<pre lang="xml">
< ?xml version="1.0" encoding="UTF-8"?>
< !DOCTYPE taglib PUBLIC "-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.1//EN" "http://java.sun.com/j2ee/dtds/web-jsptaglibrary_1_1.dtd">
<taglib>
    <tlib -version>1.0</tlib>
    <jsp -version>2.0</jsp>
    <short -name>jr</short>
    <uri>calendar@huaiyu.com</uri>
    <tag>
        <name>calendar</name>
        </tag><tag -class>
            com.kettas.servlet.TagCalendar
        </tag>
        <body -content>empty</body>
 </taglib></pre>
<font color="red"><br />
 name指定标签名<br />
 tag -class标签名于相应的类对应</font>
<!--more--><br /></p>

<p><strong>3.类文件 ：TagCalendar.java</strong>
<pre lang="java">
package com.kettas.servlet;
import java.io.IOException;
import java.util.Calendar;
import java.util.GregorianCalendar;
import javax.servlet.jsp.JspException;
import javax.servlet.jsp.tagext.TagSupport;
import javax.servlet.jsp.JspWriter;</pre></p>

<p>public class TagCalendar extends TagSupport {<br />
    private static final long serialVersionUID = -7677534442361565504L;<br />
    @Override<br />
    public int doStartTag() throws JspException {<br />
        JspWriter out = pageContext.getOut();<br />
        StringBuffer sCalendar = new StringBuffer();<br />
        GregorianCalendar gc = new GregorianCalendar();<br />
        int today = gc.get(Calendar.DAY_OF_MONTH);<br />
        int month = gc.get(Calendar.MONTH);<br />
        int year = gc.get(Calendar.YEAR);<br />
        String days[] = new String[42];<br />
        for (int i = 0; i < 42; i++) {<br />
            days[i] = "";<br />
        }<br />
        Calendar cal = Calendar.getInstance();<br />
        cal.clear();<br />
        cal.set(Calendar.MONTH, month); // 设置当月<br />
        cal.set(Calendar.YEAR, year); // 设置当年<br />
        cal.setFirstDayOfWeek(Calendar.SUNDAY);// 设置星期天开始<br />
        cal.set(Calendar.DAY_OF_MONTH, 1); // 设置1号<br />
        int firstIndex = cal.get(Calendar.DAY_OF_WEEK) - 1; // 取得当月1号所在的星期数<br />
        int maxIndex = cal.getActualMaximum(Calendar.DAY_OF_MONTH); // 取得当月的最大天数<br />
        for (int i = 0; i < maxIndex; i++) {<br />
            days[firstIndex + i] = String.valueOf(i + 1);<br />
        }<br />
        try {<br />
            sCalendar.append("
<table border="0" width="168" height="81">");</table><br />
            sCalendar.append("
<tr>
<td colspan="7" align="center">"+year + "年" + (month + 1) + "月" + today+"日</td>
</tr></p>

<p>");<br />
            sCalendar.append("
<tr>
<th width="25" height="16"><font color="red">日</font></th></tr></p>

<p>");<br />
            sCalendar.append("
<th width="25" height="16">一</th>
<th width="25" height="16">二</th></p>

<p>");<br />
            sCalendar.append("
<th width="25" height="16">三</th>
<th width="25" height="16">四</th></p>

<p>");<br />
            sCalendar.append("
<th width="25" height="16">五</th>
<th width="25" height="16"><font color="red"> 六</font></th>
</p>

<p>");<br />
            for(int i=0;i&lt;6;i++){<br />
                sCalendar.append("
<tr>");</tr><br />
                for(int j=i*7;j< (i+1)*7;j++){<br />
                    sCalendar.append("
<td width="15%" height="16" valign="middle" align="center">");<br />
                    if((j-firstIndex+1)==today){<br />
                        sCalendar.append("<font color="red">"+days[j]+"</font>");<br />
                    }else{<br />
                        sCalendar.append(days[j]);<br />
                    }<br />
                    sCalendar.append("");<br />
                }<br />
                sCalendar.append("</td></p>

<p>");<br />
            }<br />
            sCalendar.append("");<br />
            out.print(sCalendar.toString());<br />
        } catch (IOException e) {<br />
            e.printStackTrace();<br />
        }<br />
        return TagSupport.SKIP_BODY;<br />
    }<br />
}

<p><strong>4.jsp文件：calendar.jsp</strong></p>
<pre lang="jsp">
< %@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
< %@ taglib prefix="jr" uri="calendar@huaiyu.com"%>
< !DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head></html></pre></p>

<p>
<body>
<jr :calendar />
</body>


<p>－－－－－>注意jsp文件中的uri与tld中的uri相一致，不然找不到tld文件</p>
</p>
