---
layout: post
title: Java中比较两个对象是否相等
categories:
- Java Core
tags:
- equals
- Java Core
published: true
comments: true
---
<p>这段代码来自于Lang包中的一个类，其中的思想可以学习学习！
<pre lang="java">
/**
 * 判断两个对象是否相等。 这个函数用处是:
 * <ul>
 * <li>可以容忍 null
 * </li><li>可以容忍不同类型的 Number
 * </li><li>对数组，集合， Map 会深层比较
 * </li></ul>
 * 当然，如果你重写的 equals 方法会优先
 * 
 * @param a1
 *            比较对象1
 * @param a2
 *            比较对象2
 * @return 是否相等
 */
public static boolean equals(Object a1, Object a2) {
	if (a1 == a2)
		return true;
	if (a1 == null || a2 == null)
		return false;
	if (a1.equals(a2))
		return true;
	if (a1 instanceof Number)
		return a2 instanceof Number && a1.toString().equals(a2.toString());
	if (a1 instanceof Map && a2 instanceof Map) {
		Map< ?, ?> m1 = (Map< ?, ?>) a1;
		Map< ?, ?> m2 = (Map< ?, ?>) a2;
		if (m1.size() != m2.size())
			return false;
		for (Entry< ?, ?> e : m1.entrySet()) {
			Object key = e.getKey();
			if (!m2.containsKey(key) || !equals(m1.get(key), m2.get(key)))
				return false;
		}
		return true;
	} else if (a1.getClass().isArray()) {
		if (a2.getClass().isArray()) {
			int len = Array.getLength(a1);
			if (len != Array.getLength(a2))
				return false;
			for (int i = 0; i < len; i++) {
				if (!equals(Array.get(a1, i), Array.get(a2, i)))
					return false;
			}
			return true;
		} else if (a2 instanceof List) {
			return equals(a1, Lang.collection2array((List</pre><object>) a2,<br />
					Object.class));<br />
		}<br />
		return false;<br />
	} else if (a1 instanceof List) {<br />
		if (a2 instanceof List) {<br />
			List< ?> l1 = (List< ?>) a1;<br />
			List< ?> l2 = (List< ?>) a2;<br />
			if (l1.size() != l2.size())<br />
				return false;<br />
			int i = 0;<br />
			for (Iterator< ?> it = l1.iterator(); it.hasNext();) {<br />
				if (!equals(it.next(), l2.get(i++)))<br />
					return false;<br />
			}<br />
			return true;<br />
		} else if (a2.getClass().isArray()) {<br />
			return equals(Lang.collection2array((List< object>) a1,<br />
					Object.class), a2);<br />
		}<br />
		return false;<br />
	} else if (a1 instanceof Collection && a2 instanceof Collection) {<br />
		Collection< ?> c1 = (Collection< ?>) a1;<br />
		Collection< ?> c2 = (Collection< ?>) a2;<br />
		if (c1.size() != c2.size())<br />
			return false;<br />
		return c1.containsAll(c2) && c2.containsAll(c1);<br />
	}<br />
	return false;<br />
}
</object></p>
