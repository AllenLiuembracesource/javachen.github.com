
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>hadoop自动化安装shell脚本 - JavaChen Blog</title>
    <meta name="description" content="自动化安装hadoop的shell脚本">
    <meta name="keywords" content="hadoop, hive, remote debug, mapreduce">
    <meta name="author" content="JavaChen">
    <meta name="copyright" content="© http://blog.javachen.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css " rel="stylesheet">
    <link href="/assets/themes/havee/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/havee/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" media="all" />

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="canonical" href="http://blog.javachen.com/hadoop/2013/08/02/hadoop-install-script" />
    <!-- fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="JavaChen Blog ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="JavaChen Blog RSS Feed">

    


  </head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/" title="JavaChen Blog">JavaChen Blog</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
          
          
          


  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  




          <li>
	        <form class="form-inline" role="form" onsubmit="tmtxt_search_google()">
      <div class="col-lg-12 form-group">
        <input type="text" class="form-control input-sm" placeholder="Search..." id="my-google-search">
      </div>
    </form>

          </li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://blog.javachen.com/rss.xml" target="_blank" title="RSS"><span class="icon-rss icon-large"></span></a></li>
          
            <li><a href="https://github.com/javachen" target="_blank" title="Github"><span class="icon-github icon-large"></span></a></li>
          
          
          
          
          
            <li><a href="http://weibo.com/chenzhijun" target="_blank" title="Weibo"><span class="icon-weibo icon-large"></span></a></li>
          
        </ul>
      </div><!-- /.navbar-collapse -->
      </div>
    </nav>

    <div class="container">
      <div class="content">
        
<div class="row">

  <div class="col-md-9">
    <div class="page-header">
      <h2>
        hadoop自动化安装shell脚本 
        
      </h2>
    </div>
    <p>之前写过一些如何安装Cloudera Hadoop的文章，安装hadoop过程中，最开始是手动安装apache版本的hadoop，其次是使用Intel的IDH管理界面安装IDH的hadoop，再然后分别手动和通过cloudera manager安装hadoop，也使用bigtop-util yum方式安装过apache的hadoop。</p>

<p>安装过程中参考了很多网上的文章，解压缩过cloudera的<code>cloudera-manager-installer.bin</code>，发现并修复了IDH shell脚本中关于puppt的自认为是bug的一个bug，最后整理出了一个自动安装hadoop的shell脚本，脚本托管在github上面: <a href="https://github.com/javachen/hadoop-install">hadoop-install</a>。</p>

<!-- more -->

<h1>hadoop安装文章</h1>

<p>博客中所有关于安装hadoop的文章列出如下：</p>

<ol>
<li><p><a href="http://blog.javachen.com/hadoop/2013/03/08/note-about-installing-hadoop-cluster/">【笔记】Hadoop安装部署</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/03/24/manual-install-Cloudera-hive-CDH/">手动安装Cloudera Hive CDH</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/03/24/manual-install-Cloudera-hbase-CDH/">手动安装Cloudera HBase CDH</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/03/24/manual-install-Cloudera-Hadoop-CDH/">手动安装Cloudera Hadoop CDH</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/03/29/install-impala/">安装impala过程</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/04/06/install-cloudera-cdh-by-yum/">从yum安装Cloudera CDH集群</a></p></li>
<li><p><a href="http://blog.javachen.com/hadoop/2013/06/24/install-cdh-by-cloudera-manager/">通过Cloudera Manager安装CDH</a></p></li>
</ol>

<h1>hadoop-install</h1>

<p><a href="https://github.com/javachen/hadoop-install">hadoop-install</a>上脚本，all-in-one-install.sh是在一个节点上安装hdfs、hive、yarn、zookeeper和hbase，编写该脚本是为了在本机（fedora19系统）上调试mapreduce、hive和hbase；cluster-install.sh是在多个节点上安装hadoop集群，同样目前完成了hdfs、hive、yarn、zookeeper和hbase的自动安装。</p>

<h1>脚本片段</h1>

<p>IDH安装脚本中有一些写的比较好的shell代码片段，摘出如下，供大家学习。</p>

<h2>检测操作系统版本</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">( grep -i &quot;CentOS&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=centos
( grep -i &quot;Red[[:blank:]]*Hat[[:blank:]]*Enterprise[[:blank:]]*Linux&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=rhel
( grep -i &quot;Oracle[[:blank:]]*Linux&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=oel
( grep -i &quot;Asianux[[:blank:]]*Server&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=an
( grep -i &quot;SUSE[[:blank:]]*Linux[[:blank:]]*Enterprise[[:blank:]]*Server&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=sles
( grep -i &quot;Fedora&quot; /etc/issue &gt; /dev/null ) &amp;&amp; OS_DISTRIBUTOR=fedora

major_revision=`grep -oP &#39;\d+&#39; /etc/issue | sed -n &quot;1,1p&quot;`
minor_revision=`grep -oP &#39;\d+&#39; /etc/issue | sed -n &quot;2,2p&quot;`
OS_RELEASE=&quot;$major_revision.$minor_revision&quot;
</code></pre></div>
<h2>生成ssh公要</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">yes|ssh-keygen -t rsa -f /root/.ssh/id_rsa -N &quot;&quot;
[ ! -d /root/.ssh ] &amp;&amp; ( mkdir /root/.ssh ) &amp;&amp; ( chmod 700 /root/.ssh )
</code></pre></div>
<h2>ssh设置无密码登陆</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">set timeout 20

set host [lindex $argv 0]
set password [lindex $argv 1]
set pubkey [exec cat /root/.ssh/id_rsa.pub]
set localsh [exec cat ./config_ssh_local.sh]

#spawn ssh-copy-id -i /root/.ssh/id_rsa.pub root@$host
spawn ssh root@$host &quot;
umask 022
mkdir -p  /root/.ssh
echo \&#39;$pubkey\&#39; &gt; /root/.ssh/authorized_keys
echo \&#39;$localsh\&#39; &gt;  /root/.ssh/config_ssh_local.sh
cd /root/.ssh/; sh config_ssh_local.sh
&quot;
expect {
    timeout exit
    yes/no  {send &quot;yes\r&quot;;exp_continue}
    assword {send &quot;$password\r&quot;}
}
expect eof
#interact
</code></pre></div>
<h2>配置JAVA_HOME</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text"># set JAVA_HOME and PATH
if [ -f /root/.bashrc ] ; then
    sed -i &#39;/^export[[:space:]]\{1,\}JAVA_HOME[[:space:]]\{0,\}=/d&#39; /root/.bashrc
    sed -i &#39;/^export[[:space:]]\{1,\}CLASSPATH[[:space:]]\{0,\}=/d&#39; /root/.bashrc
    sed -i &#39;/^export[[:space:]]\{1,\}PATH[[:space:]]\{0,\}=/d&#39; /root/.bashrc
fi
echo &quot;&quot; &gt;&gt;/root/.bashrc
echo &quot;export JAVA_HOME=/usr/java/latest&quot; &gt;&gt;/root/.bashrc
echo &quot;export CLASSPATH=.:\$JAVA_HOME/lib/tools.jar:\$JAVA_HOME/lib/dt.jar&quot;&gt;&gt;/root/.bashrc
echo &quot;export PATH=\$JAVA_HOME/bin:\$PATH&quot; &gt;&gt; /root/.bashrc
source /root/.bashrc
</code></pre></div>
<h2>格式化集群</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">su -s /bin/bash hdfs -c &#39;yes Y | hadoop namenode -format &gt;&gt; /tmp/format.log 2&gt;&amp;1&#39;
</code></pre></div>
<h2>创建hadoop目录</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">su -s /bin/bash hdfs -c &quot;hadoop fs -chmod a+rw /&quot;
while read dir user group perm
do
     su -s /bin/bash hdfs -c &quot;hadoop fs -mkdir -R $dir &amp;&amp; hadoop fs -chmod -R $perm $dir &amp;&amp; hadoop fs -chown -R $user:$group $dir&quot;
     echo &quot;.&quot;
done &lt;&lt; EOF
/tmp hdfs hadoop 1777 
/tmp/hadoop-yarn mapred mapred 777
/var hdfs hadoop 755 
/var/log yarn mapred 1775 
/var/log/hadoop-yarn/apps yarn mapred 1777
/hbase hbase hadoop 755
/user hdfs hadoop 777
/user/history mapred hadoop 1777
/user/root root hadoop 777
/user/hive hive hadoop 777
EOF
</code></pre></div>
<h2>hive中安装并初始化postgresql</h2>
<div class="highlight"><pre><code class="text language-text" data-lang="text">yum install postgresql-server postgresql-jdbc -y &gt;/dev/null
chkconfig postgresql on
rm -rf /var/lib/pgsql/data
rm -rf /var/run/postgresql/.s.PGSQL.5432
service postgresql initdb

sed -i &#39;/listen/s/#//;/listen/s/localhost/*/&#39; /var/lib/pgsql/data/postgresql.conf
sed -i &quot;s|#standard_coffforming_strings = on|standard_conforming_strings = off|g&quot; /var/lib/pgsql/data/postgresql.conf
echo &quot;local    all             all                                 trust&quot; &gt; /var/lib/pgsql/data/pg_hba.conf
echo &quot;host     all             all             0.0.0.0/0           trust&quot; &gt;&gt; /var/lib/pgsql/data/pg_hba.conf

sudo cat /var/lib/pgsql/data/postgresql.conf | grep -e listen -e standard_conforming_strings

rm -rf /usr/lib/hive/lib/postgresql-jdbc.jar
ln -s /usr/share/java/postgresql-jdbc.jar /usr/lib/hive/lib/postgresql-jdbc.jar

su -c &quot;cd ; /usr/bin/pg_ctl start -w -m fast -D /var/lib/pgsql/data&quot; postgres
su -c &quot;cd ; /usr/bin/psql --command \&quot;create user hiveuser with password &#39;redhat&#39;; \&quot; &quot; postgres
su -c &quot;cd ; /usr/bin/psql --command \&quot;CREATE DATABASE metastore owner=hiveuser;\&quot; &quot; postgres
su -c &quot;cd ; /usr/bin/psql --command \&quot;GRANT ALL privileges ON DATABASE metastore TO hiveuser;\&quot; &quot; postgres
su -c &quot;cd ; /usr/bin/psql -U hiveuser -d metastore -f /usr/lib/hive/scripts/metastore/upgrade/postgres/hive-schema-0.10.0.postgres.sql&quot; postgres
su -c &quot;cd ; /usr/bin/pg_ctl restart -w -m fast -D /var/lib/pgsql/data&quot; postgres
</code></pre></div>
<h1>总结</h1>

<p>更多脚本，请关注github：<a href="https://github.com/javachen/hadoop-install">hadoop-install</a>，你可以下载、使用并修改其中代码！</p>

    <br/>
    <div class="copyright">
	<p><strong>本文固定链接：</strong><a href='/hadoop/2013/08/02/hadoop-install-script'>http://blog.javachen.com/hadoop/2013/08/02/hadoop-install-script</a></p>
	<p><strong>原创文章,转载请注明出处：</strong><a href='/hadoop/2013/08/02/hadoop-install-script'>JavaChen Blog</a></p>
    </div>

    <hr>
    <div class="row status">
      <div class="col-md-6">
        <div class="btn-group">
          
            <a class="btn btn-default btn-sm" href="/hadoop/2013/08/01/remote-debug-hadoop" title="远程调试hadoop各组件">&laquo; Prev</a>
          
            <a class="btn btn-default btn-sm" href="/archive.html">Archive</a>
          
            <a class="btn btn-default btn-sm" href="/hadoop/2013/08/17/some-problems-about-hadoop" title="使用hadoop中遇到的一些问题">Next &raquo;</a>
          
        </div>
      </div>
      <div class="col-md-6 visible-lg visible-md">
        <div id="bdshare" class="bdshare_t bds_tools_24 get-codes-bdshare btn-group pull-right">
          <a class="bds_tsina"></a>
          <a class="bds_tqq"></a>
          <a class="bds_t163"></a>
          <a class="bds_renren"></a>
          <span class="bds_more"></span>
        </div>
      </div>
    </div>
    


  
<div id="comments">
  <div class="ds-thread" data-title="hadoop自动化安装shell脚本 - JavaChen Blog"></div>
</div>




  </div>

  <div class="col-md-3 visible-lg visible-md">
    <section>
      <h4>Published</h4>
      <ul>
        <li>2013-08-02 00:00</li>
      </ul>
    </section>
    
    <section>
      <h4>Categories</h4>
      <ul>
        
        


  
     
    	<li><a href="/categories.html#hadoop-ref">
    		hadoop <span>12</span>
    	</a></li>
    
  


      </ul>
    </section>
    
    
    <section>
      <h4>Tags</h4>
      <ul class="tag_box">
        
        


  
     
    	<li><a href="/tags.html#hadoop-ref">hadoop <span>14</span></a></li>
     
    	<li><a href="/tags.html#hive-ref">hive <span>9</span></a></li>
     
    	<li><a href="/tags.html#hbase-ref">hbase <span>7</span></a></li>
     
    	<li><a href="/tags.html#mapreduce-ref">mapreduce <span>4</span></a></li>
    
  



      </ul>
    </section>
    

          <section>
        <h2>License</h2>
        <ul>
          <li>
            <a href="http://www.creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank"><img alt="License" src="http://blog.javachen.com/assets/images/CC.png" title="署名-非商业性使用-相同方式共享 3.0 中国大陆"></a>
          </li>
        </ul>
      </section>

  </div>

</div>


      </div>

      <footer class="text-left">
        <p>&copy; 2009-2013 <a href="/" target="_blank">JavaChen</a>. Help from <a href="http://jekyllrb.com/" target="_blank" title="Jekyll">Jekyll</a>| <script language="javascript" type="text/javascript" src="http://js.users.51.la/12111481.js"></script>
<noscript><a href="http://www.51.la/?12111481" target="_blank"><img alt="Statistic" src="http://img.users.51.la/12111481.asp" style="border:none" /></a></noscript></p>
      </footer>
            <div id="toTop"><a href="#">▲</a><a href="#footer">▼</a></div>

    </div> <!-- /container -->

        <script type="text/javascript">
    function tmtxt_search_google()
    {
      var query = document.getElementById("my-google-search").value;
      window.open("http://google.com/search?q=" + query + "%20site:blog.javachen.com");
    }
    </script>

    <script src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/havee/js/jquery.min.js"><\/script>')</script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/themes/havee/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
    <script src="/assets/themes/havee/js/main.js"></script>

    <script>
    jQuery(document).ready(function() {
      jQuery("p img").each(function() {
        var strA = "<a id='fancyBox' href='" + this.src + "'></a>";
        jQuery(this).wrapAll(strA);
      });
    });

    jQuery("#fancyBox").fancybox({
      openEffect	: 'elastic',
      closeEffect	: 'elastic',
    });
    </script>

        <!--多说js加载开始，一个页面只需要加载一次 -->
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"javachen"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script>
    <!--多说js加载结束，一个页面只需要加载一次 -->
        <!-- Baidu Button BEGIN -->
    <script type="text/javascript" id="bdshell_js"></script>
    <script>document.write(unescape('%3Cscript%20type%3D%22text/javascript%22%20id%3D%22bdshare_js%22%20data%3D%22type%3Dtools%26amp%3Buid%3D1539895%22%3E%3C/script%3E'));</script>
    <script type="text/javascript">
      var bds_config = {
        'wbUid':2074421551,
        'review':'normal',
        'snsKey':{
          'tsina':'722958853'
        }
      };
      document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
    </script>
    <!-- Baidu Button END -->

  </body>
</html>

