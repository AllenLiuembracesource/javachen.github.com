<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    	<link rel="alternate" type="application/rss+xml" title="RSS 2.0 - all posts" href="http://blog.javachen.com/atom.xml" />
    	<link REL="SHORTCUT ICON" HREF="http://blog.javachen.com/images/favicon.ico"/>
		<meta name="keywords" content="html,xhtml,css,js,javascript,ajax,jQuery,java,struts,struts2,hibernate,spring,jpa,maven,ant,git,github,jekyll,markdown,wiki,
    java,jboss,JDG,EDS,bi,pentaho,kettle,nosql,cassandra,hadoop,bigdata,cloud,opensource,openstack" />
		<meta name="description" content="javachen" />

		<meta property="wb:webmaster" content="61eb31a6e636506d" />
    	<meta name="ujianVerification" content="f8b60286538bf86567069598d8a5d6cc" />
    	<meta name="wumiiVerification" content="eec4ca3c-ccdb-4c0f-9fe3-4499d87649a3" />
		<title>kettle进行数据迁移遇到的问题</title>
		
		<link rel="stylesheet" href="/css/main.css" />
		<link rel="stylesheet" href="/css/pygments_native.css" />
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Handlee">
	</head>
	<body>
		<header id="header">
			<div class="header-info fix">
				<h1><a href="/">JavaChen Blog</a></h1>
				<p class="describe">&lt; Dive into Java ... /&gt;</p>
				<nav class="navigation">
					<ul>
						<li><a href="/">Home</a></li>
						<li><a href="/archive.html">Archive</a></li>
						<!--<li><a href="/sitemap.txt">网站地图</a></li>-->
						<li><a href="/about.html">About</a></li>
						<li><a href="/atom.xml">RSS</a></li>
					</ul>
				</nav>
			</div>
		</header><!--/header end-->

		<section id="content" class="fix">
			<article id="post">
	<a href="#" class="icon-fullscreen r" title="点击全屏显示"></a>
	<div class="c9">
		分类：
			
			<a href="/category.html#Pentaho">Pentaho</a>
			
			
		&emsp;&emsp;&emsp;&emsp;
		标签：Kettle, Pentaho
		&emsp;&emsp;&emsp;&emsp;
		<time date="2012-01-04 00:00:00 +0800">2012-01-04</time>
		&emsp;&emsp;&emsp;&emsp;
		<a href='#comment' title='分享文章、查看评论' style="float:right;margin-right:.5em;">Comments</a>
	</div>

	<h1>kettle进行数据迁移遇到的问题</h1>

	<p>使用kettle进行oracle或db2数据导入到mysql或postgres数据库过程中遇到以下问题，以下只是一个简单描述，详细的说明以及所做的代码修改没有提及。下面所提到的最新的pdi程序是我修改kettle源码并编译之后的版本。</p>




<p>1. <strong>同时运行两个pdi程序</strong>，例如：一个为oracle到mysql，另一个为oracle到postgres，其中一个停止运行
<strong>原因：</strong>从oracle迁移到mysql创建的作业和转换文件和oracle到postgres的作业和转换保存到一个路径，导致同名称的转换相互之间被覆盖，故在运行时候会出现混乱。
<strong>解决办法：</strong>将新建的作业和转换分别保存在两个不同的路径，最好是新建两个不同路径的仓库，关于如何新建仓库，请参考《kettle使用说明》文档。</p>




<p><strong>2. 关键字的问题。</strong>Oracle初始化到mysql，关键字前面会加上前缀“MY_”。如果在建表的时候出现错误，则需要检查表的字段中是否有关键字。
<strong>解决办法：</strong>出差的表单独进行处理，新建一个转换，实现关键字段该名称然后初始化出错的表。具体操作参见文档。</p>




<p>oracle中的字段名从中可以有#号，但是到mysql会报错
<strong>解决办法：</strong>字段改名称，去掉#号</p>




<p>3. <strong>Db2初始化到mysql或是postgres出错</strong>
<strong>原因：</strong>1）db2数据库连接用户没有权限访问出错的表；2）出错的表名存在小写字母
<strong>解决办法：</strong>使用更新后的pdi程序，更新后的程序会将db2的表名使用双引号括起来。</p>




<p>4. Oracle到mysql和pg时日期类型数据值有偏差
<strong>原因：</strong>从oracle中读取日期类型的数据时候，读取结果与oracle数据库中的数据已经存在偏差。少数记录使用oracle10g的驱动读取数据少一个小时，用oracle11g的驱动会多一个小时，该问题尚待oracle工程师给出解决方案。</p>




<p><strong>5. 主键</strong>从ORACLE导入不到MYSQL和POSTGRES
<strong>原因：</strong>pdi程序中没有对主键进行处理
<strong>解决办法：</strong>使用更新的pdi程序，执行Tools-Wizzard-Copy Tables Extension...功能添加主键；执行Tools-Wizzard-Copy Tables Data Only...功能可以只复制数据</p>




<p><strong>6. Oracle中存在ascii字符导入到postgres时候报错</strong>：ERROR: invalid byte sequence for encoding "UTF8": 0x00
<strong>原因：</strong>PostgreSQL内部采用C语言风格的字符串（以0x00）表示结尾，因而不允许字符串中包括0x00，建议在转换时先对字符串类型的数据进行清洗，也就是增加一个节点用于删除字符串数据中的特殊字符0x00。
<strong>解决办法:</strong>使用新的pdi程序。<br />
在kettle的DataBase类中修改PreparedStatement.setString(int index,String value)方法传入的参数，将value的值trim之后在setString</p>




<p>7. <strong>异构数据库之间的类型兼容问题</strong>。日期类型和时间类型的数据初始化到mysql或postgres中都为时间类型的数据，导致数据对比时候数据不一致。
<strong>原因：</strong>Pdi程序中的类型转换采用的是向上兼容的方式，故日期和时间类型都转换为时间类型数据。
<strong>解决办法：</strong>针对与db2数据初始化到mysql和postgres，该问题在最新的pdi程序中已经处理。因为oracle中的日期类型字段既可以存日期又可以存时间，故没针对oracle数据做出处理。</p>




<p>8. Db2中没有主键的数据初始化到mysql和postgres需要添加<strong>索引</strong>
<strong>解决办法：</strong>使用最新的pdi程序，最新的pdi程序会添加主键和索引。</p>




<p>9. Db2中decimal（n,m）类型的数据初始化到postgres数据库被<strong>四舍五入</strong>。
<strong>原因：</strong>Db2中decimal（n,m）类型的数据初始化到postgres中的类型不对。
<strong>解决办法：</strong>使用最新的pdi程序。</p>




<p>10. 导数据中途时没有报错，直接软件退出
<strong>原因：</strong>1）jvm内存溢出，需要修改jvm参数；2）pdi程序报swt错误
<strong>解决办法：</strong>修改jvm参数</p>




<p>11.<strong>初次使用kettle做db2的初始化会报错</strong>
<strong>原因：</strong>kettle中的db2的jdbc驱动与使用的db2版本不对应。
<strong>解决办法：</strong>从db2的安装目录下拷贝jdbc驱动到kettle目录（libext/JDBC）下</p>



	<div class="eof">-<strong>原创文章，转载请注明：</strong>转载自：<a href='/2012/01/04/some-problems-about-migrating-database-datas-with-kettle.html'>JavaChen Blog</a>-
		<br/>
		<br/>
		<!-- JiaThis Button BEGIN -->
	    <div id="jiathis_style_32x32">
			<a class="jiathis_button_tsina"></a>
			<a class="jiathis_button_tqq"></a>
			<a class="jiathis_button_douban"></a>
			<a class="jiathis_button_googleplus"></a>
			<a class="jiathis_button_evernote"></a>
			<a class="jiathis_button_ujian"></a>
			<a class="jiathis_button_fav"></a>
			<a class="jiathis_button_copy"></a>
			<a class="jiathis_button_ishare"></a>
			<a href="http://www.jiathis.com/share?uid=1352701524431612" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
			<a class="jiathis_counter_style"></a>

			<script type="text/javascript" >
			var jiathis_config={
				data_track_clickback:true,
				summary:"",
				ralateuid:{
					"tsina":"chenzhijun"
				},
				hideMore:false
			}
			</script>
			<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1352701524431612" charset="utf-8"></script>

			<!-- JiaThis Button END -->
			<script type="text/javascript" id="wumiiRelatedItems"></script>
			<script type="text/javascript">
			    var wumiiPermaLink = ""; //请用代码生成文章永久的链接
			    var wumiiTitle = ""; //请用代码生成文章标题
			    var wumiiTags = ""; //请用代码生成文章标签，以英文逗号分隔，如："标签1,标签2"
			    var wumiiSitePrefix = "http://blog.javachen.com/";
			    var wumiiParams = "&num=9&mode=1&pf=JAVASCRIPT";
			</script>
			<script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget"></script>
			<a href="http://www.wumii.com/widget/relatedItems" style="border:0;">
			    <img src="http://static.wumii.cn/images/pixel.png" alt="无觅相关文章插件，快速提升流量" style="border:0;padding:0;margin:0;" />
			</a>
			<!-- Wumii Related END -->
		</div>
	</div>
	
	<hr/>
	<div class="page fix">
		
		<span class="prev"><a href="/2011/12/07/mondrian-and-olap.html">← Mondrian and OLAP</a></span>
		
		
		<span class="next"><a href="/2012/01/05/add-primary-keys-and-indexes-when-migrating-datas-whith-kettle.html">使用kettle数据迁移添加主键和索引 →</a></span>
		
	</div>
	<hr/>
</article>

<div id="comment">
	<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"javachen"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
</div>

<script src="/js/jquery-min.js"></script>
<script src="/js/Fullscreen.js"></script>
<script type="text/javascript">
$(function() {
	// =============== 全屏显示 ==================
	(function() {
		var icon = $( 'a.icon-fullscreen' ),
			fs, fsCallback;
		
		fsCallback = function(isFullscreen) {
				if (isFullscreen) {
					icon.addClass('expand').attr('title', 'ESC 退出全屏');
				}
				else {
					icon.removeClass('expand').attr('title', '点击全屏显示');
				}
			};
			
		fs = new Fullscreen({
				element: $('#post'),
				noSafari: true,
				callback: fsCallback
			});

		if (fs.fullscreenEnabled) {
			icon.on('click', function() {
				fs.toggleFullscreen();
				return false;
			});
		}
		else {
			icon.hide();
		}
	})();


	// ============== 目录提取 ===============
	(function() {
		// 设置无目录时，不显示
		if (!parseInt('', 10)) {
			return;
		}

		var dom = $('<fieldset id="catalogue"><legend>目录</legend></fieldset>'),
			count = 0;
		
		$('#post').find('h2,h3,h4,h5').each(function() {
			var name = 'catalogue_' + count++;
			dom.append('<div class="txt_' + this.tagName + '">' +
				'<a href="#' + name + '">' +
					this.innerHTML +
				'</a></div>');
			this.id = name;
		});

		dom.appendTo('body');
	})();
});
</script>
<!-- UJian Button BEGIN -->
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide&btn=4&fade=1&uid=1709061"></script>
<!-- UJian Button END -->


		</section><!--/content end-->

		<footer id="footer">
			<p class="l">
				&copy; 2013 <a href="http://blog.javachen.com">JavaChen</a>. | Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://pages.github.com/">GitHub Pages</a>
			</p>
			<!--Templates from <a href='https://github.com/calefy/calefy.github.com' target='_blank'>calefy</a>.-->
			<p class="r">
				<script language="javascript" type="text/javascript" src="http://js.users.51.la/12111481.js"></script>
<noscript><a href="http://www.51.la/?12111481" target="_blank"><img alt="Statistic" src="http://img.users.51.la/12111481.asp" style="border:none" /></a></noscript>
			</p>
			<p class="tac">
				『纸上得来终觉浅，绝知此事要躬行』
			</p>
		</footer><!--/footer end-->



	</body>
</html>
